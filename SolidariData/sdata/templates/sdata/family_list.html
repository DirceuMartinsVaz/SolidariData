{% extends "sdata/base.html" %}
{% block content %}

<h1>Lista de Famílias Cadastradas</h1>

<!-- Button to add a new family -->
<button type="button" class="btn-primary" onclick="window.location.href='{% url 'family_create' %}'">
    Cadastrar nova família
</button>

<div class="form-row">    
     <div class="form-group">
        <!-- Dropdown to choose order by field -->
        <form method="get">
            <label for="order_by">Ordenar por:</label>
            <select name="order_by" id="order_by" onchange="this.form.submit()">
                <option value="family_id" {% if order_by == 'family_id' %}selected{% endif %}>Código</option>
                <option value="family_representative_name" {% if order_by == 'family_representative_name' %}selected{% endif %}>Nome do representante
                </option>
            </select>
        </form>
     </div>
    <div class="form-group">
         <!-- Dropdown for selecting page size -->
    <form method="get">
        <label for="per_page">Famílias por página:</label>
        <select name="per_page" id="per_page" onchange="this.form.submit()">
            <option value="10" {% if per_page == '10' %}selected{% endif %}>10</option>
            <option value="20" {% if per_page == '20' %}selected{% endif %}>20</option>
            <option value="50" {% if per_page == '50' %}selected{% endif %}>50</option>
        </select>
        <input type="hidden" name="order_by" value="{{ order_by }}">
        <input type="hidden" name="page" value="{{ page_obj.number }}">
    </form>
    </div>
   
</div>


<!-- Family list table -->
<table>
    <thead>
        <tr>
            <th>
                <a href="?order_by=family_id" class="{% if order_by == 'family_id' %}active-sort{% endif %}">Código</a>
            </th>
            <th>
                <a href="?order_by=family_representative_name" class="{% if order_by == 'family_representative_name' %}active-sort{% endif %}">
                    Nome do representante
                </a>
            </th>
            
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for family in page_obj %}
        <tr>
            <td class="center">{{ family.family_id }}</td>
            <td>{{ family.family_representative_name }}</td>
            <td class="center">
                <button type="button" class="btn-secondary" onclick="window.location.href='{% url 'family_detail' family.pk %}'">
                    Detalhar
                </button>
                <button type="button" class="btn-primary" onclick="window.location.href='{% url 'family_update' family.pk %}'">
                    Editar
                </button>
                <button type="button" class="btn-danger" onclick="window.location.href='{% url 'family_delete' family.pk %}'">
                    Excluir
                </button>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3" style="text-align: center;">Nenhuma família encontrada.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination controls -->
<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
        <a href="?page=1&order_by={{ order_by }}">&laquo; Primeira</a>
        <a href="?page={{ page_obj.previous_page_number }}&order_by={{ order_by }}">Anterior</a>
        {% endif %}

        <span>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&order_by={{ order_by }}">Próxima</a>
        <a href="?page={{ page_obj.paginator.num_pages }}&order_by={{ order_by }}">Última &raquo;</a>
        {% endif %}
    </span>
</div>

{% endblock %}
